---
title: "NetflixTitles"
author: "Jeff Grayum"
date: "5/21/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading libraries
```{r}
library(tidyverse)
library(tidytuesdayR)
library(scales)
library(ggthemes)
library(ggdark)
library(lubridate)
theme_set(theme_tufte())
theme_set(dark_theme_light())

```

Importing data.
```{r}
tuesdata <- tidytuesdayR::tt_load('2021-04-20')

netflix_titles <- tuesdata$netflix_titles %>%
  separate(duration, c("duration", "duration_units"), sep = " ", convert = TRUE ) %>%
  mutate(date_added = mdy(date_added))

netflix_titles %>%
  view()

netflix_titles %>%
  count(type)

netflix_titles %>%
  count(release_year)
```

Looking at ratio of movies/tv shows by decade.
```{r}
netflix_titles %>%
  ggplot(aes(release_year, fill = type)) +
  geom_histogram(binwidth = 5) +
  labs(x = "Release year",
       y = "",
       fill = NULL) +
  facet_wrap(~ type, ncol = 1, scales = "free_y") +
  theme(legend.position = "none")

netflix_titles %>%
  count(decade = 10 * (release_year %/% 10), type) %>%
  group_by(type) %>%
  mutate(percent = n / sum(n)) %>%
  ggplot(aes(decade, percent, color = type)) +
  geom_line()
```

Comparing duration of movies over time.
```{r}
netflix_titles %>%
  filter(type == "Movie") %>%
  mutate(decade = 10 * (release_year %/% 10)) %>%
  ggplot(aes(decade, duration, group = decade)) +
  geom_boxplot() +
  labs(title = "Length of movies on Netflix",
       y = "Duration (mins)",
       x = "Decade released")
 
```

Lets look at categories.
```{r}
netflix_titles %>%
  separate_rows(listed_in, sep = "," ) %>%
  count(listed_in, sort = TRUE)

netflix_titles %>%
  separate_rows(listed_in, sep = ", " ) %>%
  group_by(type, genre = listed_in) %>%
  summarize(n = n(),
            median_duration = median(duration)) %>%
  arrange(desc(n)) %>%
  filter(type == "Movie") %>%
  filter(genre != "Movies") %>%
  mutate(genre = fct_reorder(genre, median_duration)) %>%
  ggplot(aes(median_duration, genre, fill = genre)) +
  geom_col() +
  labs(x = "Median duration",
       y = "Genre") +
  theme(legend.position = "none")

```

Date added.
```{r}
netflix_titles %>%
  filter(!is.na(date_added)) %>%
  arrange(date_added) %>%
  select(type, title, date_added)

netflix_titles %>%
  filter(!is.na(date_added)) %>%
  count(year_added = year(date_added))

netflix_titles %>%
  filter(!is.na(date_added)) %>%
  mutate(year_added = pmax(year(date_added), 2015)) %>%
  count(year_added, type) %>%
  ggplot(aes(year_added, n, fill = type)) +
  geom_area(alpha = 0.7) +
  labs(x = "Year added",
       y = "",
       fill = "", 
       title = "Titles added to Netflix each year")
```

